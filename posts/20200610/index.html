<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja-jp" lang="ja-jp">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.60.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>zshでパイプ後の標準入力を利用したコマンド置換でハマった。 &middot; さやかちゃんドットネット</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://blog.sayakachan.net/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://blog.sayakachan.net/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://blog.sayakachan.net/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://blog.sayakachan.net/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:image" content="https://blog.sayakachan.net/images/twitter_card_image.jpg"/>
  <meta name="twitter:title" content="zshでパイプ後の標準入力を利用したコマンド置換でハマった。"/>
  <meta name="twitter:description" content="コマンド置換(echo $(command)など)がbashではうまくいくけどzshでうまくいかないことがあって、なんでだろうなーとしばらく思っていたのが今日解決したので書いておきます。"/>
</head>

  <body class="theme-base-0a ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://blog.sayakachan.net/"><h1>blog.sayakachan.net</h1></a>
      <p class="lead">
       とあるWeb系企業に勤める社会人のブログです。 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        
        <li><a href="https://sayakachan.net/"> Portfolio </a></li>
      </ul>
    </nav>

    
    <p>&copy; 2020 sayakachan.net</p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>zshでパイプ後の標準入力を利用したコマンド置換でハマった。</h1>
  <time datetime=2020-06-10T00:00:00&#43;0900 class="post-date">Wed, Jun 10, 2020</time>
  <p>コマンド置換(<code>echo $(command)</code>など)がbashではうまくいくけどzshでうまくいかないことがあって、なんでだろうなーとしばらく思っていたのが今日解決したので書いておきます。</p>
<h1 id="heading">ハマったところ</h1>
<p>zshでDocument以下の適当なtxtファイルについてディレクトリ名を表示させようと以下のコマンドを書いたところ、</p>
<pre><code>$ find ~/Documents -name &quot;*.txt&quot; | tail -n 1 | dirname &quot;$(cat)&quot;
cat: -: 入力/出力エラーです
.
</code></pre><p>となって上手く行かない。bashだとちゃんと上手くいく。</p>
<pre><code>$ bash
$ find ~/Documents -name &quot;*.txt&quot; | tail -n 1 | dirname &quot;$(cat)&quot;
/home/atsushi/Documents/thesis/fig
$ exit
exit
</code></pre><p>簡単にした例として以下のコマンドを試してみる。</p>
<pre><code>$ echo test | echo $(cat)
cat: -: 入力/出力エラーです

</code></pre><p>やっぱり上手く行かない。どうもパイプ後の標準入力を利用したコマンド置換が上手くいっていないようだということが分かった。</p>
<h1 id="heading1">原因</h1>
<p>zshとbashだとパイプ越しのコマンド置換での/dev/stdinの指してる先が違うということを知った。これは <a href="https://twitter.com/systemctl_ryoto">@systemctl_ryoto</a> さんに教えてもらいました(ありがとうございました&hellip;!)。</p>
<p>以下の画像は左がzsh、右がbashで試したもの。<code>readlink -f シンボリックリンク</code> はシンボリックリンクを再帰的に遡って元のファイル名を表示してくれる。</p>
<figure>
    <img src="/images/20200610/001.png"/> 
</figure>

<ul>
<li>1段目で今自分が使っているシェルを表示。</li>
<li>2段目で <code>/dev/stdin</code> の指している先を確認。これは想定どおりでどちらもターミナルからの入力らしきところを指している。</li>
<li>3段目でパイプ後の <code>/dev/stdin</code> の指している先を確認。これも想定どおりでどちらもパイプ元の出力らしきところを指している。</li>
<li>4段目でパイプ後にコマンド置換の中で <code>/dev/stdin</code> の指している先を確認。これは想定外でbashはパイプ元の出力を、zshはターミナルからの入力を指してしまっている。</li>
</ul>
<h1 id="heading2">対策</h1>
<pre><code>$ echo test | xargs echo
test
$ echo 2 | xargs -I{} echo 1 {} 3
1 2 3
</code></pre><p>これも <a href="https://twitter.com/systemctl_ryoto">@systemctl_ryoto</a> さんにアイデアをいただきました。ありがとうございました。</p>
</div>


    </main>

    
  </body>
</html>
